
# $Id: Makefile.in,v 1.16 2004/01/26 23:30:36 jimg Exp $

@SET_MAKE@

# Set makefile variables, some with values supplied by configure 
# DEFS gets the `-D' defines that describe what a particular system has
# or doesn't have.

PROG = www_int

DODS_ROOT = @dods_relative@

INCS = -I. @INCS@
DEFS = @DEFS@ -DWWW_INT_VER=\"@VERSION@\"
CPPFLAGS = @CPPFLAGS@ $(DEFS) $(INCS)
CFLAGS = @CFLAGS@
CXXFLAGS = @CXXFLAGS@
LDFLAGS = @LDFLAGS@ -L.
LFLAGS = -8
YFLAGS = -d
LIBS = -ldap++ @LIBS@
TEST_COV_FLAGS = -ftest-coverage -fprofile-arcs
TAGS_FLAGS = --include=../../dap/TAGS

# Set the instalation directories; prefix can be set on the command line
# during Makefile construction with `./configure --prefix /my/choice'

prefix = @prefix@
exec_prefix = $(prefix)
bindir = $(exec_prefix)bin
libdir = $(exec_prefix)lib
includedir = $(prefix)include
manext = 1
mandir = $(prefix)man/man$(manext)

src = $(DODS_ROOT)src
etcdir = $(DODS_ROOT)etc

INSTALLMAN = man

SHELL = /bin/sh
srcdir = @srcdir@
version = @VERSION@
basedir = www-interface
dir = $(basedir)-$(version)

# testsuite specifics
RUNTEST = runtest
RUNTESTFLAGS = #--all --verbose

# names of key programs

LN_S = @LN_S@
CP = cp
AWK = @AWK@
TAR = @TAR@
CC = @CC@
CXX = @CXX@
YACC = @YACC@
LEX = @LEX@
AR = ar
TAGS = etags
RANLIB = @RANLIB@
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
STRIP = strip

CLIENTSRCS = WWWByte.cc WWWInt32.cc WWWFloat64.cc WWWStr.cc \
	WWWUrl.cc WWWArray.cc WWWStructure.cc WWWList.cc \
	WWWSequence.cc WWWGrid.cc WWWUInt32.cc \
	WWWInt16.cc WWWUInt16.cc WWWFloat32.cc WWWOutput.cc

CLIENTOBJS = WWWByte.o WWWInt32.o WWWFloat64.o WWWStr.o \
	WWWUrl.o WWWArray.o WWWStructure.o WWWList.o \
	WWWSequence.o WWWGrid.o WWWUInt32.o \
	WWWInt16.o WWWUInt16.o WWWFloat32.o WWWOutput.o

WWW_INT_SRCS = www_int.cc
WWW_INT_OBJS = www_int.o

ALLSRCS=$(CLIENTSRCS) $(WWW_INT_SRCS)

all: $(PROG)

javascript.h: www.js
	./js2h.pl $< > $@

www_int: $(WWW_INT_OBJS) $(CLIENTOBJS)
	$(CXX) $(LDFLAGS) -o www_int $(WWW_INT_OBJS) $(CLIENTOBJS) $(LIBS)

# Standard targets with some customization for das-test and dds-test

install: install-client

install-client: www_int
	$(INSTALL_PROGRAM) -s www_int $(etcdir)

check: 
	@echo "No tests"

test-coverage: clean
	$(MAKE) $(MFLAGS) CXXFLAGS="$(CXXFLAGS) $(TEST_COV_FLAGS)" check

# Note that the gcov options -f and -b are useful but sometimes make looking
# at the results of coverage analysis a little taxing. -b reports on all
# branched and -f reports on all functions. The -l -o options summarize on a
# per-file basis. 3/27/98 jhrg
collect-coverage-data:
	(cd test-coverage; \
         cov_dat="coverage-data-`date +%m.%d.%y`"; \
	 touch $$cov_dat; \
	 for f in $(ALLSRCS); do \
	     echo "\n*** Coverage data for $$f ***\n" >> $$cov_dat; \
	     gcov -l -o ../ $$f >> $$cov_dat; \
         done)

# these tests all fail when das-test is linked with -lnew_debug.

clean:	
	-rm -f *.o *.sum *.log *~ core
	-rm -f javascript.h
	-rm -f $(PROG)

distclean: clean
	-rm -f config.status config.log config.cache

.PHONY: docs
docs:
	doc++ -d docs -f $(ALLSRCS)

configure: configure.in $(DODS_ROOT)etc/aclocal.m4
	autoconf --localdir=$(DODS_ROOT)etc

Makefile: Makefile.in
	if [ -x ./config.status ]; \
	then \
	    ${SHELL} ./config.status; \
	else \
	    ./configure; \
	fi

.PHONY: depend
depend: 
	@depend@ -m Makefile.in -- $(CPPFLAGS) -- $(ALLSRCS)
	$(MAKE) $(MFLAGS) Makefile

.PHONY: update-version
update-version: check-version
	@echo "Version is: `cat version.h`"
	if [ ! -d ../$(dir) ]; then \
	    mv ../$(basedir)* ../$(dir);\
	fi

# Compare the version encoded in this Makefile (set by configure) with the
# version in version.h. The version make variable is set up near the top of
# the Makefile.
.PHONY: check-version
check-version:
	@echo "Checking for version.h and Makefile version match-up"
	@if [ "$(version)" != "`cat version.h`" ]; \
	then \
		echo "You must manually re-run configure!"; \
		exit 1; \
	else \
		echo "Yes, they match."; \
	fi

# This is a special tar target because it builds not only the tar file for
# the core software but also the lib, etc, and bin directories. It assumes
# that the root directory for DODS is called `DODS' (no version number).
.PHONY: tar
tar:
	-rm -r config.cache config.log config.status
	cd $(DODS_ROOT).. && \
	$(TAR) --exclude 'old' --exclude '.#*' --exclude 'CVS' \
	    --exclude '.flc' --exclude '.snprj' --exclude 'Makefile' \
	    --gzip --create --dereference --file DODS-$(dir).tar.gz \
	    DODS/src/tools/$(dir)

binary-tar:
	@echo "This program's binary-tar is made by the src/dap Makefile"

.PHONY: tags
tags:
	$(TAGS) $(TAGS_FLAGS) *.cc *.h

.SUFFIXES:      .o .cc .c

.c.o:
	$(CC) -c $(CFLAGS) $(CPPFLAGS) -o $@ $<

.cc.o:
	$(CXX) -c $(CXXFLAGS) $(CPPFLAGS) -o $@ $<

# DO NOT DELETE; depend depends on this line.
WWWByte.o: WWWByte.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/InternalErr.h \
  ../../../include/Error.h WWWByte.h ../../../include/Byte.h \
  ../../../include/dods-datatypes.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h WWWOutput.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWInt32.o: WWWInt32.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/InternalErr.h \
  ../../../include/Error.h WWWInt32.h ../../../include/Int32.h \
  ../../../include/dods-datatypes.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h WWWOutput.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWFloat64.o: WWWFloat64.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/InternalErr.h \
  ../../../include/Error.h WWWFloat64.h ../../../include/Float64.h \
  ../../../include/dods-datatypes.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h WWWOutput.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWStr.o: WWWStr.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/InternalErr.h \
  ../../../include/Error.h WWWStr.h ../../../include/dods-limits.h \
  ../../../include/Str.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h ../../../include/dods-datatypes.h \
  WWWOutput.h ../../../include/DDS.h ../../../include/DAS.h \
  ../../../include/Clause.h ../../../include/expr.h \
  ../../../include/RValue.h
WWWUrl.o: WWWUrl.cc config_www_int.h WWWUrl.h WWWStr.h \
  ../../../include/dods-limits.h ../../../include/Str.h \
  ../../../include/BaseType.h ../../../include/AttrTable.h \
  ../../../include/Pix.h ../../../include/IteratorAdapter.h \
  ../../../include/Error.h ../../../include/InternalErr.h \
  ../../../include/dods-datatypes.h WWWOutput.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWArray.o: WWWArray.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/InternalErr.h \
  ../../../include/Error.h ../../../include/escaping.h WWWArray.h \
  ../../../include/Array.h ../../../include/dods-limits.h \
  ../../../include/Vector.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h ../../../include/dods-datatypes.h \
  ../../../include/DDS.h ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h WWWOutput.h
WWWStructure.o: WWWStructure.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/DAS.h \
  ../../../include/AttrTable.h ../../../include/Error.h \
  ../../../include/InternalErr.h WWWStructure.h \
  ../../../include/Structure.h ../../../include/BaseType.h \
  ../../../include/dods-datatypes.h ../../../include/Constructor.h \
  ../../../include/DDS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h WWWSequence.h \
  ../../../include/Sequence.h WWWOutput.h
WWWSequence.o: WWWSequence.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/DAS.h \
  ../../../include/AttrTable.h ../../../include/Error.h \
  ../../../include/InternalErr.h WWWSequence.h \
  ../../../include/Sequence.h ../../../include/BaseType.h \
  ../../../include/dods-datatypes.h ../../../include/Constructor.h \
  WWWOutput.h ../../../include/DDS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWGrid.o: WWWGrid.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/Array.h \
  ../../../include/dods-limits.h ../../../include/Vector.h \
  ../../../include/BaseType.h ../../../include/AttrTable.h \
  ../../../include/Error.h ../../../include/InternalErr.h \
  ../../../include/dods-datatypes.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h \
  ../../../include/escaping.h WWWGrid.h ../../../include/Grid.h \
  ../../../include/Constructor.h WWWOutput.h
WWWUInt32.o: WWWUInt32.cc config_www_int.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h ../../../include/InternalErr.h \
  ../../../include/Error.h WWWUInt32.h ../../../include/UInt32.h \
  ../../../include/dods-datatypes.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h WWWOutput.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWInt16.o: WWWInt16.cc config_www_int.h ../../../include/InternalErr.h \
  ../../../include/Error.h WWWInt16.h ../../../include/Int16.h \
  ../../../include/dods-datatypes.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h WWWOutput.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWUInt16.o: WWWUInt16.cc config_www_int.h ../../../include/InternalErr.h \
  ../../../include/Error.h WWWUInt16.h ../../../include/UInt16.h \
  ../../../include/dods-datatypes.h ../../../include/BaseType.h \
  ../../../include/AttrTable.h ../../../include/Pix.h \
  ../../../include/IteratorAdapter.h WWWOutput.h ../../../include/DDS.h \
  ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWFloat32.o: WWWFloat32.cc config_www_int.h \
  ../../../include/InternalErr.h ../../../include/Error.h WWWFloat32.h \
  ../../../include/Float32.h ../../../include/dods-datatypes.h \
  ../../../include/BaseType.h ../../../include/AttrTable.h \
  ../../../include/Pix.h ../../../include/IteratorAdapter.h WWWOutput.h \
  ../../../include/DDS.h ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h
WWWOutput.o: WWWOutput.cc config_www_int.h ../../../include/Regex.h \
  ../../../include/BaseType.h ../../../include/AttrTable.h \
  ../../../include/Pix.h ../../../include/IteratorAdapter.h \
  ../../../include/Error.h ../../../include/InternalErr.h \
  ../../../include/dods-datatypes.h ../../../include/Array.h \
  ../../../include/dods-limits.h ../../../include/Vector.h \
  ../../../include/DDS.h ../../../include/DAS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h \
  ../../../include/escaping.h ../../../include/util.h \
  ../../../include/Byte.h ../../../include/Int16.h \
  ../../../include/UInt16.h ../../../include/Int32.h \
  ../../../include/UInt32.h ../../../include/Float32.h \
  ../../../include/Float64.h ../../../include/Str.h \
  ../../../include/Url.h ../../../include/Structure.h \
  ../../../include/Constructor.h ../../../include/Sequence.h \
  ../../../include/Grid.h WWWOutput.h
www_int.o: www_int.cc config_www_int.h ../../../include/GetOpt.h \
  ../../../include/Pix.h ../../../include/IteratorAdapter.h \
  ../../../include/BaseType.h ../../../include/AttrTable.h \
  ../../../include/Error.h ../../../include/InternalErr.h \
  ../../../include/dods-datatypes.h ../../../include/Connect.h \
  ../../../include/DAS.h ../../../include/DDS.h ../../../include/Clause.h \
  ../../../include/expr.h ../../../include/RValue.h \
  ../../../include/util.h ../../../include/Byte.h \
  ../../../include/Int16.h ../../../include/UInt16.h \
  ../../../include/Int32.h ../../../include/UInt32.h \
  ../../../include/Float32.h ../../../include/Float64.h \
  ../../../include/Str.h ../../../include/dods-limits.h \
  ../../../include/Url.h ../../../include/Array.h \
  ../../../include/Vector.h ../../../include/Structure.h \
  ../../../include/Constructor.h ../../../include/Sequence.h \
  ../../../include/Grid.h ../../../include/DataDDS.h \
  ../../../include/HTTPConnect.h ../../../include/curl/curl.h \
  ../../../include/curl/types.h ../../../include/curl/easy.h \
  ../../../include/curl/multi.h ../../../include/RCReader.h \
  ../../../include/ObjectType.h ../../../include/HTTPCache.h \
  ../../../include/config_dap.h ../../../include/ResponseTooBigErr.h \
  ../../../include/HTTPCacheDisconnectedMode.h \
  ../../../include/HTTPResponse.h ../../../include/Response.h \
  ../../../include/debug.h ../../../include/cgi_util.h \
  ../../../include/EncodingType.h WWWOutput.h javascript.h
